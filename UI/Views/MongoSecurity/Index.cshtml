@using Core
@model MongoAdminViewModel
@{
    ViewData["Title"] = "MongoDB User Panel";
}



<div class="card-dark mt-4">
    <ul class="nav nav-tabs" id="adminTab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button">Users</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="roles-tab" data-bs-toggle="tab" data-bs-target="#roles" type="button">Roles</button>
        </li>
    </ul>

    <div class="tab-content mt-3">
        <!-- Users Tab -->
        <div class="tab-pane fade show active" id="users">
            <div class="card-dark mt-4">
                <h5>Manage Users</h5>
                <form asp-action="GenerateUserScript" method="post">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label asp-for="UserModel.ActionType">Action</label>
                            <select asp-for="UserModel.ActionType" class="form-select">
                                <option value="CreateUser">Create User</option>
                                <option value="DropUser">Drop User</option>
                                <option value="UpdatePassword">Update Password</option>
                                <option value="GrantRole">Grant Role</option>
                                <option value="RevokeRole">Revoke Role</option>
                                <option value="ListUsers">List Users</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="UserModel.DatabaseName">Database</label>
                            <input asp-for="UserModel.DatabaseName" class="form-control" placeholder="Optional" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="UserModel.UserName">User Name</label>
                            <input asp-for="UserModel.UserName" class="form-control" placeholder="User Name" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="UserModel.Password">Password</label>
                            <input asp-for="UserModel.Password" type="password" class="form-control" placeholder="Password" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="UserModel.SelectedRoles">Roles</label>
                            <select asp-for="UserModel.SelectedRoles" class="form-select" multiple>
                                <option>read</option>
                                <option>readWrite</option>
                                <option>dbAdmin</option>
                                <option>userAdmin</option>
                                <option>root</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-success w-100 mt-3">Generate Script</button>
                        </div>
                    </div>
                </form>

                @if (!string.IsNullOrWhiteSpace(Model.UserModel.GeneratedScript))
                {
                    <hr />
                    <h5>Generated Nosql Script</h5>
                    <div class="mb-2">
                        <button id="copyButton" class="btn btn-sm btn-outline-secondary" onclick="copyScript()">Copy</button>
                        <a class="btn btn-sm btn-outline-success" href="data:text/plain;charset=utf-8,@Uri.EscapeDataString(Model.UserModel.GeneratedScript)" download="alter-column.sql">Download</a>
                    </div>
                    <pre id="scriptArea" style="white-space:pre-wrap; background:#1e1e1e; color:#e6e6e6; padding:15px; border-radius:6px;">@Model.UserModel.GeneratedScript</pre>

                }
            </div>
        </div>

        <!-- Roles Tab -->
        <div class="tab-pane fade" id="roles">
            <div class="card-dark mt-4">
                <h5>Manage Roles</h5>
                <form asp-action="GenerateRoleScript" method="post">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label asp-for="RoleModel.ActionType">Action</label>
                            <select asp-for="RoleModel.ActionType" class="form-select">
                                <option value="CreateRole">Create Role</option>
                                <option value="DropRole">Drop Role</option>
                                <option value="AddPrivilege">Add Privileges</option>
                                <option value="RevokePrivilege">Revoke Privileges</option>
                                <option value="ListRoles">List Roles</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="RoleModel.RoleName">Role Name</label>
                            <input asp-for="RoleModel.RoleName" class="form-control" placeholder="Role Name" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="RoleModel.DatabaseName">Database</label>
                            <input asp-for="RoleModel.DatabaseName" class="form-control" placeholder="Optional" />
                        </div>
                        <div class="col-md-12">
                            <label asp-for="RoleModel.PrivilegesJson">Privileges JSON</label>
                            <textarea asp-for="RoleModel.PrivilegesJson" class="form-control" rows="3" placeholder='[ { "resource": { "db": "test", "collection": "" }, "actions": ["find","insert"] } ]'></textarea>
                        </div>
                        <div class="col-md-12">
                            <label asp-for="RoleModel.ParentRoles">Parent Roles</label>
                            <select asp-for="RoleModel.ParentRoles" class="form-select" multiple>
                                <option>read</option>
                                <option>readWrite</option>
                                <option>dbAdmin</option>
                                <option>userAdmin</option>
                                <option>root</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-success w-100 mt-3">Generate Script</button>
                        </div>
                    </div>
                </form>

                @if (!string.IsNullOrWhiteSpace(Model.RoleModel.GeneratedScript))
                {
                    <hr />
                    <h5>Generated Nosql Script</h5>
                    <div class="mb-2">
                        <button id="copyButton" class="btn btn-sm btn-outline-secondary" onclick="copyScript()">Copy</button>
                        <a class="btn btn-sm btn-outline-success" href="data:text/plain;charset=utf-8,@Uri.EscapeDataString(Model.RoleModel.GeneratedScript)" download="alter-column.sql">Download</a>
                    </div>
                    <pre id="scriptArea" style="white-space:pre-wrap; background:#1e1e1e; color:#e6e6e6; padding:15px; border-radius:6px;">@Model.RoleModel.GeneratedScript</pre>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />


}